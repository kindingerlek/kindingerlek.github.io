---
export const prerender = true

import type { GetStaticPaths } from 'astro'
import ArtworkCollection from '@/collections/artworks'
import ArtGalleryLayout from '@/layouts/ArtGalleryLayout.astro'
import { StringUtils } from '@/utils/string'

export const getStaticPaths = (async ({ paginate }) => {
	// Get all unique artwork types
	const allArtworks = await ArtworkCollection.getAll()
	const uniqueTypes = await ArtworkCollection.getUniqueTypes(allArtworks)

	let paths = []

	for (const t of uniqueTypes) {
		// Get artworks for this type
		const artworksForType = await ArtworkCollection.getByType(t, allArtworks)
		const sortedArtworks = await ArtworkCollection.sortedByDate(artworksForType)

		const uniqueTags = await ArtworkCollection.getUniqueTags(sortedArtworks)

		// Paginate the artworks by type
		const paginatedPaths = paginate(sortedArtworks, {
			pageSize: 24,
			props: { type: t, uniqueTags },
			params: { page: '1', type: t }
		})
		paths.push(...paginatedPaths)
	}

	return paths
}) satisfies GetStaticPaths

const { page, type, uniqueTags } = Astro.props

const title = StringUtils.capitalize(type)
---

<ArtGalleryLayout page={page as any} uniqueTags={uniqueTags} title={title} />
