---
export const prerender = true

import type { GetStaticPaths } from 'astro'
import ArtworksCollection from '@/collections/artworks'
import ArtGalleryLayout from '@/layouts/ArtGalleryLayout.astro'

export const getStaticPaths = (async ({ paginate }) => {
	const allArtworks = await ArtworksCollection.getAll()
	const allArtworksByDate = await ArtworksCollection.sortedByDate(allArtworks)

	// Get unique tags and count their occurrences
	const uniqueTags = await ArtworksCollection.getUniqueTags(allArtworks)

	const tagCounts = uniqueTags.map((tag) => {
		const count = allArtworks.filter(
			(project) => project.data.tags && project.data.tags.includes(tag)
		).length
		return { tag, count }
	})

	// Sort tags by count in descending order
	const sortedTags = tagCounts.sort((a, b) => b.count - a.count).map((item) => item.tag)

	return sortedTags.flatMap((tag) =>
		paginate(allArtworksByDate, {
			pageSize: 24,
			props: { uniqueTags: sortedTags },
			params: { tag, page: '1' }
		})
	)
}) satisfies GetStaticPaths

const { page, uniqueTags } = Astro.props
const currentTag = Astro.params.tag
---

<ArtGalleryLayout page={page} uniqueTags={uniqueTags} currentTag={currentTag} title='Artworks' />
