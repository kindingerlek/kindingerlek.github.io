---
export const prerender = true

import type { GetStaticPaths, InferGetStaticPropsType } from 'astro'

import PostLayout from '@/layouts/BlogPost.astro'
import PostCollection from '@/collections/post'
import type { Config } from '@/types/data'
import type { CollectionEntry } from 'astro:content'

export const getStaticPaths = (async () => {
	const blogEntries = await PostCollection.getAll()
	return blogEntries.map((entry: CollectionEntry<'posts'>) => ({
		params: { slug: entry.slug },
		props: { entry }
	}))
}) satisfies GetStaticPaths

type Props = InferGetStaticPropsType<typeof getStaticPaths>

const { entry } = Astro.props
const { Content } = await entry.render()

const meta = {
	description: entry.data.description,
	title: entry.data.title
} as Config['meta']
---

<PostLayout post={entry} meta={meta}>
	<Content />
</PostLayout>
